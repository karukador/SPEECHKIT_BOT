# SPEECHKIT_AI_BOT

ИИ Собеседник для telegram на python с SpeechKit

**Алгоритм работы бота:**

- бот принимает текстовое или голосовое сообщение
- если получен текст, он отправляется в качестве промта в YandexGPT
- если получено голосовое сообщение:
- оно расшифровывается в текст с помощью SpeechKit
- бот отправляет текст в качестве запроса в YandexGPT
- сгенерированный YandexGPT ответ бот направит в SpeechKit для превращения текста в голос
- бот присылает пользователю ответ в том же формате, в котором пользователь присылал запрос: *текст в ответ на текст,
  голос в ответ на голос*

**Файлы папки проекта**

- bot.py — код бота
- database.py — код для работы с базой данных
- speechkit.py — код для работы со SpeechKit
- yandex_gpt.py — код для работы с Yandex GPT
- validators.py — функции для проверки лимитов
- config.py — файл для хранения полезных констант проекта
- creds.py — файл для хранения данных учётной записи
- и другие

## Размещаем бота на сервере

### Что нам понадобится:

- Приватный SSH ключ
- Имя пользователя сервера
- IP сервера
- Ссылка для клонирования бота, в данном случае: `git clone https://github.com/karukador/SPEECHKIT_BOT`

### Шаг 1. Подключение к удаленному серверу

- Получить приватный ключ для доступа к серверу
- Поместить ключ в папку `~/.ssh/`, например, такой командой:
  ```Bash
  mv ~/Downloads/ssh_p ~/.ssh/  # Если он лежит в загрузках и называется ssh_p
  ```
- Расширить права доступа ключу:
  ```Bash
  chmod 600 ~/.ssh/ssh_p
  ```
- Используя ключ, подключиться к удаленному серверу с помощью команды:
  ```Bash
  ssh -i ~/.ssh/ssh_p <username>@<ip>
  ```
- При первом подключении подтвердить свои действия командой `yes`

### Шаг 2. Подготовка сервера к запуску проекта

- Установим пакетный менеджер `pip`:
  ```Bash
  sudo apt install python3-pip -y  # Если при установке появится окно - жми Tab, затем Enter
  ```
- Установим утилиту `tmux` для запуска проекта в фоне:
  ```Bash
  sudo apt install tmux -y # Если при установке появится окно - жми Tab, затем Enter
  ```

### Шаг 3. Установка и запуск бота на сервере

- Перейдем/создадим и перейдем в директорию, в которой хотим разместить нашего бота сервере (необязательно)
- Выполним команду клонирования нашего репозитория, как делали это на своем
  компьютере `git clone https://github.com/karukador/SPEECHKIT_BOT`
- Перейдём в склонированный проект командой:
  ```Bash
  cd project  # Если ваш проект называется project
  ```
- Установим все необходимые библиотеки с помощью `pip` и нашего файлика `requirements.txt`:
  ```Bash
  pip install -r requirements.txt
  ```
- Запустим бота командой:
  ```Bash
  python3 main.py  # Такой запуск продлится до закрытия терминала
  ```
- Остановим бота сочетанием клавиш `CTRL+C`

### Шаг 4. Запуск бота в фоне с помощью tmux

- Запустим установленную на 3 шаге утилиту tmux c помощью команды:
  ```Bash
  tmux
  ```
- В новом открывшемся терминале снова запустим бота командой:
  ```Bash
  python3 main.py
  ```
- Теперь можно закрыть терминал - бот продолжит работу.

### Шаг 5. Остановка бота запущенного с помощью tmux

Чтобы выключить запущенного через tmux бота, нужно заново подключиться по ssh к удалённой машине и выполнить команду

```bash
tmux ls
```

Она выведет все активные запуски tmux, например:

```bash
0: 1 windows (created Sun Jan 21 20:31:54 2024)
```

Эта запись показывает, во сколько был запущен бот. После этого можно выполнить команду

```bash
tmux kill-session -t <номер_бота>  # чтобы выключить бота с заданным номером.
```

Если был запущен только один бот, то его выключит команда:

```bash
tmux kill-session -t 0
```